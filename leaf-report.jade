polymer-element(name='leaf-meter', attributes="battery_capacity battery_remaining_amount battery_charging_status plugin_state cruising_range_ac_off time_required_to_full_L2_sec time_required_to_full_sec")
  style.
    .steps > div {
      width: 1em;
      height: 1em;
      background: white;
      border: 1px solid black;
    }
    .steps > div.full {
      background: purple;
    }
    leaf-meter h1 {
      margin: 0;
      font-size: 100%;
    }
    leaf-meter > div {
      border: 1px solid black;
      display: inline-flex;
      flex-direction: column;
    }
  template
    div
      div(style="flex: 0 0 auto")
        h1 Battery level
      div(style="flex: 1 0; display: flex;")
        div.steps(style="flex: 0 0 auto")
          template(repeat="{{i in steps}}")
            div(class="{{i <= remain ? 'full' : 'empty'}}") 
        div(style="flex: 0 0 auto")
          div
            | {{desc}}
          div
            | {{estimate}}
  script(src="leaf-meter.js")  

polymer-element(name='leaf-polling', attributes="draw_from draw_to next_sample recent now")
  style.
    leaf-polling #timeline {
      height: 20px;
      border-top: 1px solid black;
      border-bottom: 1px solid black;
      position: relative;
      margin-bottom: 3em;
    }
    leaf-polling .tick {
      position: absolute;
      border-left: 1px solid black;
      height: 100%;
    }
    leaf-polling .label {
      position: relative;
      top: 20px;
      width: 1px;
    }
  template
    div(style="border: 1px solid black")
      div Next sample in {{nextMin}} min
      div#timeline
        template(repeat="{{ev in events}}")
          div.tick(style="{{ev.style}}")
            div.label {{ev.label}}
      
  script(src="leaf-polling.js")

polymer-element(name='leaf-predict', attributes='previous')
  link(rel="stylesheet", href="/lib/rickshaw/71877d994a/src/css/graph.css")
  template
    | predict2
    #chart
    #slider
  script(src="/lib/rickshaw/71877d994a/vendor/d3.v3.js")
  script(src="/lib/rickshaw/71877d994a/rickshaw.min.js")
  script(src="leaf-predict.js?v3")
    
polymer-element(name='leaf-report')
  template
    style.
      @host { :scope {display: block;} }
      section {
        margin-top: .4em;
        margin-bottom: 1em;
        outline: 1px solid gray;
      }
    section
      leaf-meter#meter(battery_capacity="12",
                  battery_remaining_amount="7",
                  battery_charging_status="NOT_CHARGING",
                  plugin_state="NOT_CONNECTED",
                  cruising_range_ac_off="58",
                  time_required_to_full_L2_sec="",
                  time_required_to_full_sec="9 hours",
                 )
    section
      leaf-polling(
            draw_from=  "1234567000",
            draw_to=    "1234570000",
            next_sample="1234570000",
            recent="[ [\"1234567480\",\"ok\"],[\"1234567880\",\"failed\"] ]",
            now=        "1234568000")
    div
      leaf-predict(previous="{{latestRead.previous}}")
    div
      | The latest report was fetched {{latestRead.data_time}}, {{latestRead.data_time | fromNow}}
    div Latest report:
    section
      div
        | plugin_state:
        b {{latestRead.plugin_state}}
      div
        | battery_charging_status:
        b {{latestRead.battery_charging_status}}
      div battery_capacity: {{latestRead.battery_capacity}}
      div battery_remaining_amount: {{latestRead.battery_remaining_amount}}
    section
      div
        | cruising_range_ac_off:
        b {{latestRead.cruising_range_ac_off | meterToMile}}
      div cruising_range_ac_on: {{latestRead.cruising_range_ac_on | meterToMile}}
    section
      div
        | time_required_to_full_L2_sec: {{latestRead.time_required_to_full_L2_sec | humanizeSec}}
      div time_required_to_full_sec: {{latestRead.time_required_to_full_sec | humanizeSec}}
    section
      div
        | operation_date_and_time:
        b {{latestRead.operation_date_and_time | fromNow}}
      div notification_date_and_time: {{latestRead.notification_date_and_time | fromNow}}
      div
        | last_battery_status_check_execution_time: {{latestRead.last_battery_status_check_execution_time | fromNow}}
      div data_time: {{latestRead.data_time | fromNow}}
      | refresh button here that posts a request
  script(src='/lib/jquery-2.0.3.js')
  script(src='/lib/moment.min.js')
  script(src='leaf-report.js')

  // listen for leaf-report update signal, rerun refresh